// Next.js API route support: https://nextjs.org/docs/api-routes/introduction
// require('dotenv').config();
import type { NextApiHandler, NextApiRequest, NextApiResponse } from 'next';
import Cors from 'cors';
import { createVercelHandler } from '@last-rev/graphql-contentful-core';

import lrConfig from '../../../../lrconfig';

function initMiddleware(middleware: any) {
  return (req: NextApiRequest, res: NextApiResponse<any>) =>
    new Promise((resolve, reject) => {
      middleware(req, res, (result: any) => {
        if (result instanceof Error) {
          return reject(result);
        }
        return resolve(result);
      });
    });
}

const cors = initMiddleware(
  Cors({
    // Only allow requests with GET, POST and OPTIONS
    methods: ['GET', 'POST', 'OPTIONS']
  })
);

const handler: NextApiHandler = async (req, res) => {
  await cors(req, res);

  return await createVercelHandler(
    lrConfig.clone({
      contentStrategy: 'cms', // always use cms content strategy for live api,
      cmsCacheStrategy: 'redis',
      apolloServerOptions: {
        introspection: false
      }
    })
  )(req, res);
};

export default handler;

API Summary:
This file contains an API route handler for Next.js. It sets up a CORS middleware and handles requests to the specified API route. The handler uses the createVercelHandler function from the '@last-rev/graphql-contentful-core' package to process the request and generate a response.

Import statements:
- NextApiHandler, NextApiRequest, NextApiResponse: These are types imported from the 'next' package that define the types for the API handler function and its parameters.
- Cors: This is a package that provides Cross-Origin Resource Sharing (CORS) middleware for Express.
- createVercelHandler: This is a function imported from the '@last-rev/graphql-contentful-core' package that creates a handler function for processing GraphQL requests.

Internal Functions:
- initMiddleware: This function takes a middleware function as a parameter and returns a new function that wraps the middleware. It handles the asynchronous nature of the middleware by returning a Promise that resolves or rejects based on the result of the middleware execution.

External Services:
- '@last-rev/graphql-contentful-core': This package provides functionality for handling GraphQL requests and interacting with a Contentful CMS.

API Endpoints:
GET /api/route
Summary: This endpoint handles GET requests to the '/api/route' route. It sets up CORS middleware and uses the createVercelHandler function to process the request and generate a response.

Example Usage:
```
curl -X GET \
  http://localhost:3000/api/route \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
  "data": "data"
}'
```

Example Response:
```json
{
  "response": "data"
}
```

Interaction Summary:
When a GET request is made to '/api/route', the handler function first calls the CORS middleware to handle CORS-related headers. Then, it calls the createVercelHandler function with a modified lrConfig object to create a handler function for processing the request. The handler function processes the request using the specified content strategy, CMS cache strategy, and Apollo Server options. The response generated by the handler function is returned to the client.

Developer Questions:
- What is the purpose of the lrConfig object and how is it used in the createVercelHandler function?
- How can I modify the allowed HTTP methods in the CORS middleware?
- What are the available options for the contentStrategy and cmsCacheStrategy in the lrConfig object?
- How can I enable introspection for the Apollo Server options?